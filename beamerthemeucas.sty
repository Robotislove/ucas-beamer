\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemeucas}[2019/01/03]

\mode<presentation>

\DeclareOptionBeamer{label}{\def\ucasbeamer@option@label{#1}}
\ExecuteOptionsBeamer{label = UCAS}

\DeclareOptionBeamer{logo}{\def\ucasbeamer@option@logo{#1}}
\ExecuteOptionsBeamer{logo = AMSS}

\RequirePackage{booktabs}
\RequirePackage[T1]{fontenc}
\RequirePackage{PTSans}
% setting font
\@ifpackageloaded{ctex}
 {% if loaded package ctex
  \setmainfont{Times New Roman}% setting Times New Roman as the default english font
  \renewcommand*{\em}{\kaishu}
 }
 {% else
  \RequirePackage[english]{babel}
 }

\ProcessOptionsBeamer

% define the path of label and logo
\def\ucasbeamer@pathname@label{label/}
\def\ucasbeamer@pathname@logo{logo/}

% define the filename of label and logo
\def\ucasbeamer@filename@label{%
  \ucasbeamer@pathname@label \ucasbeamer@option@label%
}
\def\ucasbeamer@filename@logo{%
  \ucasbeamer@pathname@logo \ucasbeamer@option@logo%
}

% ------------------------------ Setting Length ------------------------------ %

% Define the margin
\newlength\ucasbeamer@length@margin
\ucasbeamer@length@margin = 14pt

% Define the footline height
\newlength\ucasbeamer@length@footlineheight
\ucasbeamer@length@footlineheight = 8pt

% Define the footline bottom padding
\newlength\ucasbeamer@length@footlinebottompadding
\ucasbeamer@length@footlinebottompadding = 6pt

% Define the maxwidth and maxheight of logo
\newlength\ucasbeamer@length@logomaxwidth
\ucasbeamer@length@logomaxwidth = 72pt
\newlength\ucasbeamer@length@logomaxheight
\ucasbeamer@length@logomaxheight = 36pt

% Define the toppading
\newlength\ucasbeamer@length@toppadding
\ucasbeamer@length@toppadding = 24pt

% Define the title page's label height
\newlength\ucasbeamer@length@labelheight@titlepage
\ucasbeamer@length@labelheight@titlepage = 42pt

% Define the not title page's label height
\newlength\ucasbeamer@length@labelheight
\ucasbeamer@length@labelheight = 28pt

% ------------------------------- Define color ------------------------------- %

\definecolor{ucasbeamer@base}{RGB}{0, 64, 152}
\definecolor{ucasbeamer@graybase}{RGB}{240, 240, 240}
\definecolor{ucasbeamer@gray}{RGB}{130, 130, 130}
\definecolor{ucasbeamer@orange}{RGB}{240,140,0}
\definecolor{ucasbeamer@red}{RGB}{210, 26, 66}
\definecolor{ucasbeamer@green}{RGB}{0, 127, 0}

% ------------------------------ Define command ------------------------------ %
\providecommand{\red}[1]{{\color{ucasbeamer@red}{#1}}}
\providecommand{\green}[1]{{\color{ucasbeamer@green}{#1}}}

% --------------------------------- Setting ---------------------------------- %
% use infolines
\useoutertheme{infolines}
% seting text margin
\setbeamersize{%
  text margin left=\ucasbeamer@length@margin,
  text margin right=\ucasbeamer@length@margin}


% setting page frametitle and framesubtitle
\setbeamertemplate{frametitle}{%
  \vskip\ucasbeamer@length@toppadding
  \vtop{{%
    \usebeamerfont{frametitle}{\insertframetitle}%
    \ifx\insertframesubtitle\@empty\else\\
      \usebeamerfont{framesubtitle}{\insertframesubtitle}
    \fi}
  \vfill}}

% cancel the navigation symbols
\setbeamertemplate{navigation symbols}{}

% setting background
\setbeamertemplate{background canvas}{%
  \ifnum\value{page} = 1
      \let\ucasbeamer@temp@length\ucasbeamer@length@labelheight@titlepage
  \else
      \let\ucasbeamer@temp@length\ucasbeamer@length@labelheight
  \fi
  \leavevmode\hskip\ucasbeamer@length@margin
  \includegraphics[height = \ucasbeamer@temp@length]%
  {\ucasbeamer@filename@label}%
}

% setting fooline
\setbeamertemplate{footline}{%
  \hskip\ucasbeamer@length@margin
  \usebeamercolor[fg]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertshortauthor
  \ \lower2pt\hbox{\Large$\cdot$}\
  \usebeamercolor[fg]{title in head/foot}%
    \usebeamerfont{title in head/foot}\insertshorttitle
  \ \lower2pt\hbox{\Large$\cdot$}\
  \usebeamercolor[fg]{date in head/foot}%
    \usebeamerfont{date in head/foot}\insertshortdate
  \hfill
  \insertframenumber{} / \inserttotalframenumber
  \hskip\ucasbeamer@length@margin
  \vrule width 0pt height \ucasbeamer@length@footlineheight
         depth \ucasbeamer@length@footlinebottompadding}

% setting title page
\setbeamertemplate{title page}{%
  \vfill
  \begin{center}
    {\usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle}%
    \smallskip

    {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle}%
    \vfill

    {\usebeamerfont{author} \insertauthor}%
    \medskip

    {\usebeamerfont{institute} \insertinstitute}%
    \medskip

    \includegraphics%
    [
      width = \ucasbeamer@length@logomaxwidth,
      height = \ucasbeamer@length@logomaxheight,
      keepaspectratio
    ]{\ucasbeamer@filename@logo}%
    \vfill

    {\usebeamerfont{date}\centering \insertdate}%
  \end{center}
}

% setting the font and forward color of structure
\setbeamerfont{structure}{series = \bfseries}
\setbeamercolor{structure}{fg = ucasbeamer@gray}

% setting the font and forward color of alerted
\setbeamerfont{alerted text}{series = \bfseries}
\setbeamercolor{alerted text}{fg = ucasbeamer@orange}

% setting the font, fontsize and forward color of title
\setbeamerfont{title}{size = \Large, series = \bfseries}
\setbeamercolor{title}{fg = ucasbeamer@base}
\setbeamerfont{title in head/foot}{size = \tiny, series = \bfseries}
\setbeamercolor{title in head/foot}{parent = structure}

% setting the font and fontsize of author name
\setbeamerfont{author}{series = \bfseries, size = \small}
\setbeamerfont{author in head/foot}{size = \tiny, series = \bfseries}
\setbeamercolor{author in head/foot}{parent = structure}

% setting the font and fontsize of date
\setbeamerfont{date}{size = \footnotesize}
\setbeamerfont{date in head/foot}{size = \tiny, series = \bfseries}
\setbeamercolor{date in head/foot}{parent=structure}

% setting the shape of item as square
\setbeamertemplate{itemize items}[square]

% setting the font and fontsize of footnote
\setbeamerfont{footnote}{size = \footnotesize}
\setbeamercolor{footnote mark}{parent = structure}

% setting the font and fontsize of frametitle, framesubtitle, head/foot in section and subsection
\setbeamerfont{frametitle}{size = \Large, series = \bfseries}
\setbeamercolor{frametitle}{parent = title}

\setbeamerfont{framesubtitle}{size = \large, series = \bfseries}
\setbeamercolor{framesubtitle}{parent = subtitle}

\setbeamerfont{section in head/foot}{parent = structure}
\setbeamercolor{section in head/foot}{parent = structure}

\setbeamerfont{subsection in head/foot}{parent = normal text}
\setbeamercolor{subsection in head/foot}{parent = structure}

% setting blocks rounded with shadow
\setbeamertemplate{blocks}[rounded][shadow = true]

% setting the color of block, example and alerted
\setbeamercolor{block title}{fg = white, bg = ucasbeamer@base}
\setbeamercolor{block title example}{%
  use = alerted text, fg = white, bg = ucasbeamer@gray}
\setbeamercolor{block title alerted}{%
  use = alerted text, fg = white, bg = ucasbeamer@orange}

% setting the textcolor and background color of block
\setbeamercolor{block body}{%
  parent = normal text, use = block title,
  bg = block title.bg!10!bg}
\setbeamercolor{block body example}{%
  parent = normal text, bg = ucasbeamer@graybase}
\setbeamercolor{block body alerted}{%
  parent = normal text, use = block title alerted,
  bg = block title alerted.bg!10!bg}

% setting the bibliography entry style
\setbeamertemplate{bibliography item}{%
  \ifboolexpr{ test {\ifentrytype{book}} or test {\ifentrytype{mvbook}}
    or test {\ifentrytype{collection}} or test {\ifentrytype{mvcollection}}
    or test {\ifentrytype{reference}} or test {\ifentrytype{mvreference}} }
    {\setbeamertemplate{bibliography item}[book]}
    {\ifentrytype{online}
      {\setbeamertemplate{bibliography item}[online]}
      {\setbeamertemplate{bibliography item}[article]}}%
  \usebeamertemplate{bibliography item}}

\mode<all>
\endinput
